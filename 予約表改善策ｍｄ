# 予約表改善策 要件定義書

## 目的
- 予約関連の操作を「予約ページ内」で完結させ、ページ遷移を減らす
- 日付切替・一覧・詳細・新規登録を統一的に扱い、操作性と体感レイテンシーを改善する
- APIの利用条件を明確化し、過剰取得を防ぐ

## 背景・現状課題
- 予約一覧/新規登録/詳細が別ページに分散しており、ユーザーのコンテキストが分断される
- `useReservations` の日付指定がページ側で安定していないと再取得が多発しやすい
- `/api/reservations` に日付範囲が付かない場合、全件取得になり得てレイテンシーが悪化する

## 目標
- 予約ページ内で「タイムライン」「一覧」「新規登録」「詳細」を切り替え表示できる
- 日付は予約ページの共通状態で管理し、一覧/タイムライン/詳細に同期する
- `/api/reservations` は日付範囲必須とし、API側でバリデーションを行う

## 非目標
- 予約機能以外のページのUI/UX刷新
- DBスキーマ変更（必要があれば別途提案）

## 用語
- 予約ページ: `/reservations` ルートに集約されるメイン画面
- セグメント: 予約ページ内の表示切り替え（例: タブ）

## 画面・UX要件
- 予約ページ内に以下のセグメントを配置
  - タイムライン
  - 一覧
  - 新規登録
  - 詳細
- 日付切替UIを予約ページ上部に設置し、全セグメントで同一日付を参照
- 一覧から「詳細」を開く場合、ページ遷移せずセグメントを切り替える
- 新規登録完了後は、作成した予約を「詳細」セグメントで表示

## 機能要件
- 予約ページ共通の状態として次を保持
  - 選択日付（Date）
  - 選択予約ID（string | null）
  - 現在のセグメント（timeline | list | register | detail）
- 一覧/タイムラインの取得は選択日付に基づく
- 詳細表示は選択予約IDに基づく
- 新規登録成功後、選択予約IDを更新して詳細へ遷移

## API要件
- `/api/reservations` の GET は `start_date` と `end_date` を必須にする
  - 未指定の場合は 400 を返す
  - 例外的に ID 指定（id）の場合は日付不要
- クライアントは必ず日付範囲を付与して一覧/タイムラインを取得する

## 非機能要件
- 体感レイテンシーを抑えるため、同一日付での再フェッチを減らす
- 予約ページ内の切り替えはページ遷移なしで行う

## 受け入れ条件
- `/reservations` で予約関連の主要操作が完結する
- 一覧から詳細へ遷移しても URL 変更はない（ページ遷移なし）
- 新規登録後に詳細が即時表示される
- `/api/reservations` で日付が未指定の一覧取得は 400 になる

## 影響範囲
- `src/app/reservations/page.tsx`（予約ページ統合）
- `src/app/reservations/list/page.tsx`（埋め込み or 遷移抑制）
- `src/app/reservations/register/page.tsx`（埋め込み or 遷移抑制）
- `src/app/api/reservations/route.ts`（日付必須化）
- `src/hooks/useReservations.ts`（日付依存の取得）

## 検討事項
- 既存のルーティングを残す場合の挙動（リダイレクト/埋め込み）
- セグメント切替のUIデザイン（タブ/セグメントボタン）
- 詳細セグメントに必要な表示情報の最小要件
