# æ¬¡ã«ã‚„ã‚‹ã¹ããƒªã‚¹ãƒˆï¼ˆ2026-01-01 æ›´æ–°ï¼‰

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¾åœ¨ã®çŠ¶æ…‹ã¨æ¬¡ã«å–ã‚Šçµ„ã‚€ã¹ãã‚¿ã‚¹ã‚¯ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

---

## ç›´è¿‘ã®ã‚¿ã‚¹ã‚¯ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰

### 1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–é‹ç”¨ + ç®¡ç†è¨­å®šæ°¸ç¶šåŒ–ï¼‰

**çŠ¶æ…‹**: æœªå®Œäº†ï¼ˆDockerãŒå¿…è¦ï¼‰

```bash
# 1. Dockerèµ·å‹•
docker start supabase_db_seikotsuin

# 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
npx supabase db push
```

**å¯¾è±¡ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**:
- `20251231000100_clinic_settings_table.sql` - `clinic_settings` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- `20260101000100_security_events_operations.sql` - `security_events` é‹ç”¨ã‚«ãƒ©ãƒ è¿½åŠ  + `notifications` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ

**ç¢ºèªäº‹é …**:
- [ ] `clinic_settings` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [ ] `security_events` ã«é‹ç”¨ã‚«ãƒ©ãƒ ï¼ˆstatus, resolved_atç­‰ï¼‰ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [ ] `notifications` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [ ] RLSãƒãƒªã‚·ãƒ¼ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨

---

### 2. E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

**çŠ¶æ…‹**: æœªå®Ÿè¡Œ

```bash
# Playwright E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆå…¨ä½“ï¼‰
npx playwright test

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–E2Eãƒ†ã‚¹ãƒˆ
npx playwright test security-monitor

# ç®¡ç†è¨­å®šE2Eãƒ†ã‚¹ãƒˆ
npx playwright test admin-settings

# UIãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
npx playwright test --ui
```

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–: ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§è¡¨ç¤ºã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†
- ç®¡ç†è¨­å®š: è¨­å®šä¿å­˜ãƒ»å¾©å…ƒã€æ¨©é™ãƒã‚§ãƒƒã‚¯

---

### 3. TypeScriptã‚¨ãƒ©ãƒ¼ä¿®æ­£

**çŠ¶æ…‹**: æ—¢å­˜ã®å‹ã‚¨ãƒ©ãƒ¼ã‚ã‚Šï¼ˆ20ä»¶ç¨‹åº¦ï¼‰

ä¸»ãªã‚¨ãƒ©ãƒ¼ç®‡æ‰€:
- `src/api/gemini/ai-analysis-service.ts` - AIåˆ†æã‚µãƒ¼ãƒ“ã‚¹ã®å‹ä¸æ•´åˆ
- `src/app/admin/actions.ts` - Headerså‹ã®ä¸æ•´åˆï¼ˆNext.js 15å¯¾å¿œï¼‰
- `src/hooks/useSystemSettings.ts` - æ¼”ç®—å­ã®å„ªå…ˆé †ä½
- `src/lib/session-manager.ts` - Jsonå‹ã®ä¸æ•´åˆ
- `src/types/supabase.ts` - é‡è¤‡ã™ã‚‹å‹å®šç¾©ï¼ˆai_commentsï¼‰

**å¯¾å¿œæ–¹é‡**:
```bash
# å‹ã‚¨ãƒ©ãƒ¼ç¢ºèª
npm run type-check

# ã‚¨ãƒ©ãƒ¼ç®‡æ‰€ã‚’ç‰¹å®šã—ã¦ä¿®æ­£
```

---

### 4. Supabaseå‹å®šç¾©ã®å†ç”Ÿæˆ

**çŠ¶æ…‹**: æœªå®Ÿè¡Œ

```bash
# Supabaseå‹å®šç¾©ã‚’å†ç”Ÿæˆï¼ˆæ–°ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«/ã‚«ãƒ©ãƒ ã‚’åæ˜ ï¼‰
npx supabase gen types typescript --local > src/types/supabase.ts
```

**æ³¨æ„äº‹é …**:
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨å¾Œã«å®Ÿè¡Œã™ã‚‹ã“ã¨
- é‡è¤‡ã™ã‚‹å‹å®šç¾©ï¼ˆai_commentsï¼‰ã®è§£æ¶ˆãŒå¿…è¦

---

## ä¸­æœŸã‚¿ã‚¹ã‚¯ï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰

### 5. å‹•ä½œç¢ºèªãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ

- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ç”»é¢ã§ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ãŒä¿å­˜ã•ã‚Œã‚‹
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³å¼·åˆ¶çµ‚äº†ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] é«˜é‡è¦åº¦ã‚¤ãƒ™ãƒ³ãƒˆã§é€šçŸ¥ãŒä½œæˆã•ã‚Œã‚‹
- [ ] ç®¡ç†ç”»é¢ã§å…¨è¨­å®šã‚«ãƒ†ã‚´ãƒªã®ä¿å­˜ãƒ»å¾©å…ƒãŒæ©Ÿèƒ½ã™ã‚‹

### 6. æ—¢å­˜ãƒ†ã‚¹ãƒˆã®ä¿®æ­£

ä¸€éƒ¨ã®æ—¢å­˜ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ç¢ºèªã¨ä¿®æ­£ãŒå¿…è¦:

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ãƒ†ã‚¹ãƒˆ
npm test -- --testPathPattern="security"

# ç®¡ç†è¨­å®šãƒ†ã‚¹ãƒˆ
npm test -- --testPathPattern="admin-settings"
```

### 7. SecurityDashboard UIã®æ”¹å–„

- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ãƒ¢ãƒ¼ãƒ€ãƒ«ã®UIæ”¹å–„
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ï¼ˆpolling or WebSocketï¼‰
- [ ] ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ã®å¼·åŒ–

---

## é•·æœŸã‚¿ã‚¹ã‚¯ï¼ˆå„ªå…ˆåº¦: ä½ï¼‰

### 8. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

- [ ] APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£APIè¿½åŠ ï¼‰
- [ ] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®Storybookè¿½åŠ 
- [ ] é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®ä½œæˆ

### 9. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

- [ ] è¨­å®šèª­ã¿è¾¼ã¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
- [ ] å¤§é‡ãƒ‡ãƒ¼ã‚¿æ™‚ã®ã‚¯ã‚¨ãƒªæœ€é©åŒ–

### 10. æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™

- [ ] ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
- [ ] æœ¬ç•ªDBã¸ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»
- [ ] ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã®ä½œæˆ

---

## å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–é‹ç”¨ MVP âœ… ï¼ˆ2026-01-01å®Œäº†ï¼‰

| Phase | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|-------|------|----------|
| DBè¨­è¨ˆ | security_eventsæ‹¡å¼µ + notifications | âœ… å®Œäº† |
| APIå®Ÿè£… | 5ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | âœ… å®Œäº† |
| UIæ›´æ–° | SecurityDashboard + ãƒšãƒ¼ã‚¸ | âœ… å®Œäº† |
| ãƒ†ã‚¹ãƒˆ | E2E + ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ | âœ… å®Œäº† |

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/app/api/admin/security/events/route.ts`
- `src/app/api/admin/security/metrics/route.ts`
- `src/app/api/admin/security/sessions/route.ts`
- `src/app/api/admin/security/sessions/terminate/route.ts`
- `src/components/admin/SecurityDashboard.tsx`
- `src/app/admin/(protected)/security-monitor/page.tsx`
- `src/app/admin/(protected)/security-dashboard/page.tsx`
- `supabase/migrations/20260101000100_security_events_operations.sql`

### ç®¡ç†è¨­å®šæ°¸ç¶šåŒ– MVP

| Phase | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|-------|------|----------|
| Phase 1 | DB/API/ãƒ•ãƒƒã‚¯åŸºç›¤å®Ÿè£… | âœ… å®Œäº† |
| Phase 2 | å…¨è¨­å®šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¯¾å¿œ | âœ… å®Œäº† |
| Phase 3 | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ãƒ»E2Eãƒ†ã‚¹ãƒˆ | ğŸ”„ é€²è¡Œä¸­ |

**å®Œäº†ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
- `clinic-basic-settings.tsx`
- `clinic-hours-settings.tsx`
- `booking-calendar-settings.tsx`
- `communication-settings.tsx`
- `system-settings.tsx`
- `services-pricing-settings.tsx`
- `insurance-billing-settings.tsx`
- `data-management-settings.tsx`

---

## æŠ€è¡“çš„ãªæ³¨æ„äº‹é …

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```
new â†’ investigating â†’ resolved / false_positive
```

### é«˜é‡è¦åº¦ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥

`severity=critical` ã¾ãŸã¯ `severity=error` ã®ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆæ™‚ã«è‡ªå‹•ã§ `notifications` ãƒ†ãƒ¼ãƒ–ãƒ«ã«é€šçŸ¥ãŒä½œæˆã•ã‚Œã‚‹ã€‚

### useAdminSettings ãƒ•ãƒƒã‚¯ã®ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

```tsx
import { useAdminSettings } from '@/hooks/useAdminSettings';
import { useUserProfile } from '@/hooks/useUserProfile';

const {
  data: formData,
  updateData,
  loadingState,
  handleSave,
  isInitialized,
} = useAdminSettings(initialData, clinicId ? {
  clinicId,
  category: 'category_name',
  autoLoad: true,
} : undefined);
```

---

## å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–é‹ç”¨_MVPä»•æ§˜æ›¸.md` - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–è©³ç´°ä»•æ§˜ âœ… å®Ÿè£…å®Œäº†
- `docs/ç®¡ç†è¨­å®šæ°¸ç¶šåŒ–_MVPä»•æ§˜æ›¸.md` - ç®¡ç†è¨­å®šè©³ç´°ä»•æ§˜
- `docs/E2Eå…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ä»•æ§˜æ›¸.md` - E2Eãƒ†ã‚¹ãƒˆè¨­è¨ˆ
- `docs/Playwright_E2Eæ‰‹å¼•æ›¸.md` - Playwrightãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰
- `CLAUDE.md` - é–‹ç™ºã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
