# ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è§£æ¶ˆ + ã‚¯ãƒªãƒ‹ãƒƒã‚¯é¸æŠãƒ•ã‚£ãƒ«ã‚¿ å®Ÿè£…ãƒ—ãƒ©ãƒ³

> **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: å®Ÿè£…å®Œäº† (2026-02-27)**
> TDDï¼ˆt-wadaæµ: ğŸ”´ Red â†’ ğŸŸ¢ Green â†’ ğŸ”µ Refactorï¼‰ã§å®Ÿæ–½ã€‚
> è¨ˆç”»ã¨ã®å·®ç•°ã¯æœ«å°¾ã€Œå®Ÿè£…è¨˜éŒ²ãƒ»å·®åˆ†ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã€‚

## Context

ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ã«é€šçŸ¥ãƒãƒƒã‚¸ã€Œ3ã€ãƒ»ã‚¯ãƒªãƒ‹ãƒƒã‚¯5åº—èˆ—ã®ãƒªã‚¹ãƒˆãŒãƒ™ã‚¿æ›¸ãã•ã‚Œã¦ãŠã‚Šã€
ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®ã€Œ46åº—èˆ—ã€ã‚‚é™çš„æ–‡å­—åˆ—ã€‚ã“ã‚Œã‚‰ãŒå®Ÿéš›ã®DBãƒ‡ãƒ¼ã‚¿ã¨ä¹–é›¢ã—ã¦ã„ã‚‹ãŸã‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¡¨ç¤ºå€¤ã‚’ä¿¡é ¼ã§ããªã„çŠ¶æ…‹ã€‚åŠ ãˆã¦ã€ã‚¯ãƒªãƒ‹ãƒƒã‚¯é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§
åˆ¥åº—èˆ—ã‚’é¸ã‚“ã§ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‰ãªã„å•é¡ŒãŒã‚ã‚‹ã€‚

æœ¬ãƒ—ãƒ©ãƒ³ã§ã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰è§£æ¶ˆï¼‹ã‚¯ãƒªãƒ‹ãƒƒã‚¯é¸æŠã«ã‚ˆã‚‹å…¨ç”»é¢ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ã‚’å®Ÿè£…ã™ã‚‹ã€‚

---

## å¤‰æ›´å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ5ä»¶ï¼‰âœ…
1. `src/components/navigation/header.tsx`
2. `src/app/client-layout.tsx`
3. `src/app/page.tsx`
4. `src/lib/constants.ts`
5. `src/app/reservations/page.tsx`ï¼ˆclinicId ã®å‚ç…§å…ˆå¤‰æ›´ï¼‰

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ3ä»¶ï¼‰âœ…
6. `src/app/api/clinics/route.ts` â€” å…¨èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚¯ãƒªãƒ‹ãƒƒã‚¯ä¸€è¦§ API
7. `src/providers/selected-clinic-context.tsx` â€” é¸æŠã‚¯ãƒªãƒ‹ãƒƒã‚¯çŠ¶æ…‹ç®¡ç†
8. `src/hooks/useSystemStatus.ts` â€” ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ç”¨ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆãƒ•ãƒƒã‚¯ï¼ˆå®Ÿè£…æ™‚ã«è¿½åŠ ï¼‰

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ7ä»¶ï¼‰âœ…
- `src/__tests__/pages/home.test.tsx`
- `src/__tests__/components/navigation/header-badge.test.tsx`
- `src/__tests__/components/navigation/header-clinics.test.tsx`
- `src/__tests__/components/navigation/header-backdrop.test.tsx`
- `src/__tests__/api/clinics-route.test.ts`
- `src/__tests__/providers/selected-clinic-context.test.tsx`
- `src/__tests__/pages/reservations-clinic-filter.test.tsx`

---

## Task A: é€šçŸ¥ãƒãƒƒã‚¸å‹•çš„åŒ–ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰âœ…

### èƒŒæ™¯
- `/api/admin/notifications?clinic_id=xxx&limit=100` ãŒæ—¢å­˜
- ç®¡ç†è€…ã®ã¿é€šçŸ¥ã‚’æŒã¤è¨­è¨ˆï¼ˆéç®¡ç†è€…ã¯ãƒãƒƒã‚¸éè¡¨ç¤ºï¼‰

### `header.tsx` ã®å¤‰æ›´
```typescript
// HeaderProps ã«è¿½åŠ 
notificationCount?: number;
```

ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ»ãƒ¢ãƒã‚¤ãƒ«ã®ä¸¡æ–¹ã§ã€Œ3ã€ã‚’å‹•çš„åŒ–ã—ã€0ä»¶æ™‚ã¯éè¡¨ç¤º:
```tsx
// 99ä»¶è¶…ã¯ '99+' ã‚’è¡¨ç¤ºï¼ˆå®Ÿè£…æ™‚ã«ä»•æ§˜è¿½åŠ ï¼‰
const showBadge = (notificationCount ?? 0) > 0;
const badgeLabel = (notificationCount ?? 0) >= 100 ? '99+' : notificationCount;

{showBadge && (
  <span className='absolute -top-1 -right-1 h-4 w-4 bg-[#ef4444] rounded-full text-xs flex items-center justify-center'>
    {badgeLabel}
  </span>
)}
```

> **å®Ÿè£…æ™‚è¿½åŠ ä»•æ§˜**: `notificationCount >= 100` ã®ã¨ã `'99+'` ã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆUX ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ï¼‰ã€‚
> ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« `header-badge.test.tsx` ã§ã“ã®ä»•æ§˜ãŒç¢ºèªæ¸ˆã¿ã€‚

### `client-layout.tsx` ã®å¤‰æ›´
```typescript
const [notificationCount, setNotificationCount] = React.useState(0);

React.useEffect(() => {
  if (!isAdmin || !profile?.clinicId) return;
  fetch(`/api/admin/notifications?clinic_id=${profile.clinicId}&limit=100`)
    .then(r => r.json())
    .then(result => {
      if (result.success) setNotificationCount(result.data.notifications.length);
    })
    .catch(() => {});
}, [isAdmin, profile?.clinicId]);
```

`<Header>` ã« `notificationCount={notificationCount}` ã‚’è¿½åŠ ã€‚

---

## Task B: ã‚¯ãƒªãƒ‹ãƒƒã‚¯ä¸€è¦§å‹•çš„åŒ– + é¸æŠãƒ•ã‚£ãƒ«ã‚¿ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰âœ…

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

ã‚¹ã‚¿ãƒƒãƒ•ã‚‚å…¨åº—èˆ—ã‚’è¡¨ç¤ºã—ã€é¸æŠã§ãƒ‡ãƒ¼ã‚¿ã‚‚ãƒ•ã‚£ãƒ«ã‚¿ã—ãŸã„è¦ä»¶ã«å¯¾ã—ã€
ä»¥ä¸‹ã® 3 å±¤æ§‹é€ ã§å®Ÿè£…ã™ã‚‹:

```
SelectedClinicContext (å…¨ãƒšãƒ¼ã‚¸ã‹ã‚‰å‚ç…§å¯èƒ½ãªé¸æŠä¸­ clinicId)
      â†‘ setSelectedClinicId ã‚’å‘¼ã¶
Header (ã‚¯ãƒªãƒ‹ãƒƒã‚¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³)
      â†“ selectedClinicId ã‚’å‚ç…§
å„ãƒšãƒ¼ã‚¸ (reservations/page.tsx ç­‰)
      â†“ selectedClinicId ã‚’ clinicId ã¨ã—ã¦ä½¿ã†
useAppointments / useReservationFormData ãªã©
```

### æ–°è¦: `src/providers/selected-clinic-context.tsx`

```typescript
'use client';
import { createContext, useContext, useState, ReactNode } from 'react';

interface SelectedClinicContextValue {
  selectedClinicId: string | null;
  setSelectedClinicId: (id: string) => void;
}

const SelectedClinicContext = createContext<SelectedClinicContextValue | undefined>(undefined);

export function SelectedClinicProvider({
  initialClinicId,
  children,
}: { initialClinicId: string | null; children: ReactNode }) {
  const [selectedClinicId, setSelectedClinicId] = useState<string | null>(initialClinicId);
  return (
    <SelectedClinicContext.Provider value={{ selectedClinicId, setSelectedClinicId }}>
      {children}
    </SelectedClinicContext.Provider>
  );
}

export function useSelectedClinic(): SelectedClinicContextValue {
  const ctx = useContext(SelectedClinicContext);
  if (!ctx) throw new Error('useSelectedClinic must be used within SelectedClinicProvider');
  return ctx;
}
```

### æ–°è¦: `src/app/api/clinics/route.ts`

å…¨èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒªãƒ‹ãƒƒã‚¯ã‚’å–å¾—ã§ãã‚‹è»½é‡ API:
```typescript
// GET /api/clinics
// - å…¨èªè¨¼ãƒ­ãƒ¼ãƒ« OKï¼ˆSTAFF_ROLES ã‚’ allowedRoles ã«æŒ‡å®šï¼‰
// - å…¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒªãƒ‹ãƒƒã‚¯ã‚’ name é †ã§è¿”ã™
// - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: { success: true, data: { items: Array<{ id: string; name: string }> } }
```
RLS ã¯ DB å´ã«å§”ä»»ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã¯ã™ã¹ã¦è¡¨ç¤ºã—ã€å®Ÿéš›ã® API ãƒ‡ãƒ¼ã‚¿å–å¾—ã¯
å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã® RLS ãŒåˆ¶å¾¡ã™ã‚‹ã€‚

### `src/lib/constants.ts` ã®å¤‰æ›´
```typescript
export const API_ENDPOINTS = {
  CLINICS: '/api/clinics',   // â† è¿½åŠ 
  ADMIN: { ... },            // æ—¢å­˜
} as const;
```

### `client-layout.tsx` ã®å¤‰æ›´

```typescript
// 1. ã‚¯ãƒªãƒ‹ãƒƒã‚¯ä¸€è¦§å–å¾—
const [clinics, setClinics] = React.useState<Array<{ id: string; name: string }>>([]);
const [clinicsLoading, setClinicsLoading] = React.useState(false);

React.useEffect(() => {
  if (!profile) return;
  setClinicsLoading(true);
  fetch('/api/clinics')
    .then(r => r.json())
    .then(result => { if (result.success) setClinics(result.data.items); })
    .catch(() => {})
    .finally(() => setClinicsLoading(false));
}, [profile?.id]);
```

JSX:
```tsx
<SelectedClinicProvider initialClinicId={profile?.clinicId ?? null}>
  <Header
    // æ—¢å­˜ props...
    clinics={clinics}
    clinicsLoading={clinicsLoading}
    notificationCount={notificationCount}
  />
  {/* ... rest of layout */}
</SelectedClinicProvider>
```

### `header.tsx` ã®å¤‰æ›´

**HeaderProps æ‹¡å¼µ:**
```typescript
clinics?: Array<{ id: string; name: string }>;
clinicsLoading?: boolean;
```

**å†…éƒ¨ã® `useMemo` (L49-55) ã¨ `useEffect` (L57-61) ã‚’å‰Šé™¤ã€‚**
ä»£ã‚ã‚Šã« `useSelectedClinic()` ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ•ãƒƒã‚¯ã‚’ä½¿ã†:

```typescript
const { selectedClinicId, setSelectedClinicId } = useSelectedClinic();
```

ã‚¯ãƒªãƒ‹ãƒƒã‚¯ select ã® `value` ã¨ `onChange`:
```tsx
<select
  value={selectedClinicId ?? ''}
  onChange={e => setSelectedClinicId(e.target.value)}
  disabled={clinicsLoading}
>
  {clinicsLoading
    ? <option value=''>èª­ã¿è¾¼ã¿ä¸­...</option>
    : clinics?.map(c => <option key={c.id} value={c.id}>{c.name}</option>)
  }
</select>
```

ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— (L127-137) ã¨ãƒ¢ãƒã‚¤ãƒ« (L226-236) ã®ä¸¡ select ã‚’åŒæ§˜ã«æ›´æ–°ã€‚

---

## Task C: ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ã®é…ç·šï¼ˆå„ªå…ˆåº¦: é«˜ãƒ»Task B ã¨ä¸€ä½“ï¼‰âœ…

### `src/app/reservations/page.tsx` ã®å¤‰æ›´

```typescript
// å¤‰æ›´å‰
const clinicId = profile?.clinicId ?? null;

// å¤‰æ›´å¾Œ
import { useSelectedClinic } from '@/providers/selected-clinic-context';
const { selectedClinicId } = useSelectedClinic();
const clinicId = selectedClinicId;  // profile.clinicId ã®ä»£ã‚ã‚Š
```

ã“ã‚Œã«ã‚ˆã‚Š `useAppointments(clinicId)` ãŠã‚ˆã³ `useReservationFormData(clinicId)` ãŒ
é¸æŠã‚¯ãƒªãƒ‹ãƒƒã‚¯ã§è‡ªå‹•çš„ã«å†å–å¾—ã•ã‚Œã‚‹ï¼ˆä¸¡ãƒ•ãƒƒã‚¯ã¯ clinicId å¤‰åŒ–ã‚’ useEffect ã§ç›£è¦–æ¸ˆã¿ï¼‰ã€‚

**æ³¨æ„ç‚¹:** éç®¡ç†è€…ã‚¹ã‚¿ãƒƒãƒ•ãŒä»–ã‚¯ãƒªãƒ‹ãƒƒã‚¯ã‚’é¸æŠã—ãŸå ´åˆã€
DB ã® RLS ã«ã‚ˆã‚Šå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã¯è¿”ã‚‰ãªã„ï¼ˆç©ºè¡¨ç¤ºï¼‰ã€‚ã“ã‚Œã¯ä»•æ§˜ä¸Šã®æ­£ã—ã„å‹•ä½œã€‚

---

## Task D: ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸çµ±è¨ˆå‹•çš„åŒ–ï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰âœ…

### `src/app/page.tsx` ã®å¤‰æ›´

> **è¨ˆç”»ã‹ã‚‰ã®å·®ç•°**: å½“åˆã¯ async Server Component + `dbHelpers.getClinics()` ã‚’äºˆå®šã—ã¦ã„ãŸãŒã€
> `useSystemStatus` ãƒ•ãƒƒã‚¯ã‚’ä½¿ã† Client Component ã¨ã—ã¦å®Ÿè£…ã—ãŸã€‚
> ç†ç”±: ãƒ†ã‚¹ãƒˆ (`home.test.tsx`) ãŒ `useSystemStatus` ãƒ¢ãƒƒã‚¯ã‚’å‰æã¨ã™ã‚‹å½¢ã«æ›´æ–°ã•ã‚ŒãŸãŸã‚ã€‚

```typescript
'use client';
import { useSystemStatus } from '@/hooks/useSystemStatus';
import Link from 'next/link';

const SYSTEM_STATUS_LABELS: Record<string, string> = {
  operational: 'ç¨¼åƒä¸­',
  degraded: 'ä¸€éƒ¨éšœå®³',
  outage: 'åœæ­¢ä¸­',
};
const AI_STATUS_LABELS: Record<string, string> = {
  active: 'AIç¨¼åƒä¸­',
  inactive: 'AIåœæ­¢ä¸­',
};

export default function HomePage() {
  const { status, loading } = useSystemStatus();
  const clinicCountBadge = loading ? '...' : (status?.activeClinicCount ?? 0);
  const systemStatusLabel = status
    ? (SYSTEM_STATUS_LABELS[status.systemStatus] ?? 'ç¨¼åƒä¸­')
    : 'ç¨¼åƒä¸­';
  const aiStatusLabel = status
    ? (AI_STATUS_LABELS[status.aiAnalysisStatus] ?? 'AIåˆ†æ')
    : 'AIåˆ†æ';
  // <a href="..."> ã‚’ <Link href="..."> ã«å¤‰æ›´ (3ç®‡æ‰€)
  // ãƒ­ãƒ¼ãƒ‰ä¸­ã¯ '...' ã‚’è¡¨ç¤º
}
```

### `src/hooks/useSystemStatus.ts`ï¼ˆæ–°è¦ãƒ»Task D å®Ÿè£…æ™‚ã«è¿½åŠ ï¼‰

```typescript
// GET /api/clinics + GET /api/health ã‚’ä¸¦åˆ—å‘¼ã³å‡ºã—
// activeClinicCount: clinics API ã® items.length
// systemStatus: health API ã® ok === true â†’ 'operational' | else â†’ 'degraded'
// aiAnalysisStatus: å¸¸ã« 'active'ï¼ˆai_comments ã¯ä»Šå¾Œã®æ‹¡å¼µå¯¾è±¡ï¼‰
export function useSystemStatus(): UseSystemStatusResult { ... }
```

> **æ³¨æ„**: `systemStatus` ã®ç®—å‡ºã¯ `security_events` ã§ã¯ãªã `/api/health` ã‚’åˆ©ç”¨ã€‚
> `aiAnalysisStatus` ã¯å¸¸æ™‚ `'active'` ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼ˆHC-05 ã®å®Œå…¨å‹•çš„åŒ–ã¯å¾Œç¶šã‚¿ã‚¹ã‚¯ï¼‰ã€‚

---

## Task E: ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ backdropï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰âœ…

### `header.tsx` ã®å¤‰æ›´

`closeMenus` ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’è¿½åŠ :
```typescript
const closeMenus = useCallback(() => {
  setIsUserMenuOpen(false);
  setIsAdminMenuOpen(false);
}, []);
```

ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ `Fragment` ã§ãƒ©ãƒƒãƒ—ã— backdrop ã‚’è¿½åŠ :
```tsx
{isUserMenuOpen && (
  <>
    <div className='fixed inset-0 z-40' onClick={closeMenus} aria-hidden='true' />
    <div className='absolute top-16 right-4 bg-[#1e3a8a] p-4 rounded shadow-lg md:hidden w-60 space-y-3 z-50'>
      {/* æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãã®ã¾ã¾ */}
    </div>
  </>
)}
```

ESC ã‚­ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è¿½åŠ :
```typescript
useEffect(() => {
  const onKeyDown = (e: KeyboardEvent) => {
    if (e.key === 'Escape') closeMenus();
  };
  document.addEventListener('keydown', onKeyDown);
  return () => document.removeEventListener('keydown', onKeyDown);
}, [closeMenus]);
```

---

## å®Ÿè£…é †åºã¨ä¾å­˜é–¢ä¿‚

```
Task D (page.tsx: <Link> + çµ±è¨ˆ) â† ç‹¬ç«‹ã€æœ€åˆã«ç€æ‰‹
Task A (é€šçŸ¥ãƒãƒƒã‚¸) â† ç‹¬ç«‹ã€ä¸¦åˆ—å¯
Task B (API /clinics + Context + Header) â† B â†’ C ã®é †
Task C (reservations ãƒ‡ãƒ¼ã‚¿é…ç·š) â† Task B å®Œäº†å¾Œ
Task E (ãƒ¢ãƒã‚¤ãƒ« backdrop) â† ç‹¬ç«‹
```

| é † | ã‚¿ã‚¹ã‚¯ | å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•° | æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ« |
|----|--------|--------------|------------|
| 1 | D: page.tsx å‹•çš„åŒ–ãƒ»LinkåŒ– | 1 | - |
| 2 | A: é€šçŸ¥ãƒãƒƒã‚¸ | 2 | - |
| 3 | B: API + Context + Header | 4 | 2 |
| 4 | C: reservations ãƒ‡ãƒ¼ã‚¿é…ç·š | 1 | - |
| 5 | E: ãƒ¢ãƒã‚¤ãƒ« backdrop | 1 | - |

---

## æ¤œè¨¼æ–¹æ³•

1. `npm run dev` èµ·å‹•
2. ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ â†’ ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¯ãƒªãƒ‹ãƒƒã‚¯ä¸€è¦§ãŒå…¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åº—èˆ—ã‚’è¡¨ç¤º
3. åˆ¥ã‚¯ãƒªãƒ‹ãƒƒã‚¯ã‚’é¸æŠ â†’ äºˆç´„ç”»é¢ã®ãƒ‡ãƒ¼ã‚¿ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ï¼ˆã¾ãŸã¯ç©ºï¼‰
4. ã‚¹ã‚¿ãƒƒãƒ•ãƒ­ã‚°ã‚¤ãƒ³ â†’ ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«å…¨åº—èˆ—è¡¨ç¤ºã€‚è‡ªåˆ†ä»¥å¤–ã‚’é¸æŠã™ã‚‹ã¨äºˆç´„ç”»é¢ãŒç©º
5. ç®¡ç†è€…ã§é€šçŸ¥ãŒã‚ã‚‹å ´åˆ â†’ ãƒãƒƒã‚¸ã«å®Ÿä»¶æ•°ã€‚ãªã‘ã‚Œã°ãƒãƒƒã‚¸éè¡¨ç¤º
6. ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ â†’ ã€ŒNåº—èˆ—å±•é–‹ã€ãŒ DB ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ä»¶æ•°ã¨ä¸€è‡´
7. ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®ãƒªãƒ³ã‚¯ â†’ ãƒ•ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰ãªãé·ç§» (Next.js Link)
8. ãƒ¢ãƒã‚¤ãƒ«å¹…ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‚¯ãƒªãƒƒã‚¯ â†’ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé–‰ã˜ã‚‹
9. `npm run lint` ã‚¨ãƒ©ãƒ¼ãªã—
10. `npm test` æ—¢å­˜ãƒ†ã‚¹ãƒˆå›å¸°ãªã—

---

## å®Ÿè£…è¨˜éŒ²ãƒ»å·®åˆ†ï¼ˆ2026-02-27ï¼‰

### è¨ˆç”»ã¨ã®ä¸»ãªå·®ç•°

| é …ç›® | è¨ˆç”» | å®Ÿéš›ã®å®Ÿè£… | ç†ç”± |
|------|------|-----------|------|
| Task D: page.tsx å®Ÿè£…æ–¹å¼ | `async` Server Component + `dbHelpers.getClinics()` | `'use client'` + `useSystemStatus()` ãƒ•ãƒƒã‚¯ | ãƒ†ã‚¹ãƒˆ (`home.test.tsx`) ãŒ `useSystemStatus` ãƒ¢ãƒƒã‚¯ã‚’å‰æã«æ›´æ–°ã•ã‚ŒãŸãŸã‚ |
| Task D: systemStatus ã®ç®—å‡º | `security_events` ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç›´è¿‘ã‚¤ãƒ™ãƒ³ãƒˆ | `/api/health` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã® `ok` ãƒ•ãƒ©ã‚° | `/api/system/status` æ–°è¦ API ãŒæœªå®Ÿè£…ã®ãŸã‚æ—¢å­˜ `/api/health` ã‚’å†åˆ©ç”¨ |
| Task D: aiAnalysisStatus | `ai_comments` ãƒ†ãƒ¼ãƒ–ãƒ«å½“æ—¥ãƒ‡ãƒ¼ã‚¿ | å¸¸ã« `'active'`ï¼ˆä»®å®Ÿè£…ï¼‰ | `ai_comments` API ãŒæœªå®Ÿè£…ã®ãŸã‚ã€å¾Œç¶šã‚¿ã‚¹ã‚¯ã§å¯¾å¿œ |
| Task A: ãƒãƒƒã‚¸ä¸Šé™ | `{notificationCount}` ã‚’ãã®ã¾ã¾è¡¨ç¤º | 100ä»¶ä»¥ä¸Šã¯ `'99+'` ã‚’è¡¨ç¤º | ã‚»ãƒ«ãƒ•ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã«ãƒ†ã‚¹ãƒˆãŒ `'99+'` æœŸå¾…å€¤ã«æ›´æ–°ã•ã‚ŒãŸãŸã‚ |
| æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«æ•° | 2ä»¶ | 3ä»¶ï¼ˆ`useSystemStatus.ts` ã‚’è¿½åŠ ï¼‰ | Task D ã®å®Ÿè£…æ–¹å¼å¤‰æ›´ã«ä¼´ã†è¿½åŠ  |

### æœªå®Ÿè£…é …ç›®ï¼ˆå¾Œç¶šã‚¿ã‚¹ã‚¯ã¸ï¼‰

| é …ç›® | å¯¾å¿œä»•æ§˜ | å‚™è€ƒ |
|------|---------|------|
| `aiAnalysisStatus` ã®çœŸã®å‹•çš„åŒ– | spec-hardcoded-data-dynamic v0.1 HC-05 | `ai_comments` ãƒ†ãƒ¼ãƒ–ãƒ«ç…§ä¼šãŒå¿…è¦ |
| äºˆç´„ãƒšãƒ¼ã‚¸é€šçŸ¥ã®å‹•çš„åŒ– | spec-hardcoded-data-dynamic v0.1 HC-06 | `useNotifications` ãƒ•ãƒƒã‚¯å®Ÿè£…ãŒå¿…è¦ |
| `/api/clinics/accessible` | spec-hardcoded-data-dynamic v0.1 API-02 | ã‚¹ã‚³ãƒ¼ãƒ—åˆ¶é™ãŒå¿…è¦ãªå ´åˆã«å®Ÿè£… |
| `/api/system/status` | spec-hardcoded-data-dynamic v0.1 API-03 | `security_events` + `ai_comments` é›†è¨ˆ |

### å®Ÿè£…æ¸ˆã¿ãƒ†ã‚¹ãƒˆä¸€è¦§

| ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« | å¯¾è±¡ | ãƒ†ã‚¹ãƒˆæ•° |
|-------------|------|---------|
| `home.test.tsx` | `page.tsx` å‹•çš„çµ±è¨ˆè¡¨ç¤º | 3 |
| `header-badge.test.tsx` | é€šçŸ¥ãƒãƒƒã‚¸ï¼ˆ0/5/1/100/'99+'ï¼‰ | 5 |
| `header-clinics.test.tsx` | ã‚¯ãƒªãƒ‹ãƒƒã‚¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³å‹•çš„åŒ– | 3 |
| `header-backdrop.test.tsx` | backdrop ã‚¯ãƒªãƒƒã‚¯ãƒ»ESC ã§é–‰ã˜ã‚‹ | 3 |
| `clinics-route.test.ts` | `GET /api/clinics` èªè¨¼ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ | 3 |
| `selected-clinic-context.test.tsx` | Context Provider/ãƒ•ãƒƒã‚¯å‹•ä½œ | 3 |
| `reservations-clinic-filter.test.tsx` | selectedClinicId ã®ãƒ‡ãƒ¼ã‚¿é…ç·š | 2 |
