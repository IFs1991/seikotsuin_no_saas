# 9月15日以降にやるべきリスト（MVP稼働準備）

本リストは、SaaSのMVPを動かすために実施するタスクを時系列で整理したものです。必要に応じて関連ドキュメントを参照してください。

## 手順（順番に実施）

1) ライセンス決定
- 現状は `UNLICENSED`。このまま運用 or 独自LICENSE/PolyForm Internalを検討して `LICENSE` を追加。READMEにも方針を明記。

2) セキュリティ連絡先更新
- `SECURITY.md` の `security@example.com` を自社窓口に差し替え。

3) GitHubへ初回プッシュ
- コマンド例:
  ```bash
  git init
  git add -A && git commit -m "chore: prepare for GitHub publish"
  git branch -M main
  git remote add origin <your-github-repo-url>
  git push -u origin main
  ```

4) GitHub設定
- Secret Scanning / Dependabot 有効化
- Branch protection（必須チェック=CI、レビュー必須、force-push禁止）

5) Supabaseプロジェクト作成
- リージョンは東京近傍
- Auth: サイトURL/RedirectにVercelドメインとローカルURLを登録

6) SQL適用（順番厳守）
- `src/api/database/schema.sql`
- `src/api/database/functions.sql`
- （導入時のみ）`src/api/database/rls-policies.sql`
- （必要時）`src/lib/database/csp-violations-schema.sql` → `src/lib/database/csp-alert-functions.sql`
- （RLS検証）`validate_rls.sql`
- 詳細は「SQLの配置場所.md」を参照。

7) 初期データ投入
- 最低限の `clinics` を1件作成し、生成された `id` を控える。
- 必要に応じて `staff/patients/visits/revenues/daily_reports` も少量投入。

8) 権限初期化
- `user_permissions` に管理ユーザ（`role='admin'`）を作成し、Step7の `clinic_id` と紐付け。

9) 環境変数設定（Vercel/ローカル）
- 必須: `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_ROLE_KEY`, `NEXTAUTH_URL`, `NEXTAUTH_SECRET`, `NEXT_PUBLIC_DEFAULT_CLINIC_ID`
- 任意: `GEMINI_API_KEY`/`GOOGLE_AI_API_KEY`, `UPSTASH_REDIS_*`（利用時）

10) Vercel連携とデプロイ
- GitHubからインポート
- `vercel.json` のリージョン/ビルド設定確認
- Previewで検証 → 問題なければProductionへ

11) 動作確認（手動）
- 日報: `/daily-reports` 表示 → `/daily-reports/input` 保存 → 一覧に反映
- 収益: `/revenue` 表示でサマリ/ランキングが表示
- 患者: `/patients` 表示（未ログイン=サンプル、ログイン=実データ/RLS適用）
- ダッシュボード: `/dashboard` で当日サマリ/AIコメント確認

12) RLS適用（任意/推奨）
- 導入する場合は `rls-policies.sql` を適用後、`validate_rls.sql` で状況確認。
- 未定義参照（`therapist_patient_assignments` 等）は後続対応 or 該当箇所を保留。

13) CI/レビュー運用開始
- PR作成 → CI（lint/typecheck/test）パス確認
- Dependabot PRを定期的に取り込み

14) 仕上げ（任意）
- 認証連携で `staff_id` の自動付与
- グラフ/表のリッチ化、サンプルデータ `sql/seeds/` の整備
- `SECURITY.md`/`README` の最終整備

## 参考ドキュメント
- 公開計画: `docs/github-publish-plan.md`
- FE/BE整合計画: `docs/fe-be-alignment-plan.md`
- SQL配置: `SQLの配置場所.md`

## 注意
- `SUPABASE_SERVICE_ROLE_KEY` はサーバーサイド（`/api/*`）のみで使用。クライアントへ露出しないよう管理してください。
