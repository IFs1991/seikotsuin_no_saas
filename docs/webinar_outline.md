
# ウェビナー構成案（40–60分）
非エンジニアがSaaSを設計する時に意識したこと（セキュリティ含む）

## 目的
- 独学1年2ヶ月の視点で「意思決定の順番」を伝える
- セキュリティを「怖い話」ではなく「設計の型」として示す
- 再現可能なフレーム（課題→データ→権限→運用）を持ち帰ってもらう

## 話し方のルール（共有用）
- キャリア話は短く「動機の強さ」を伝えるだけに留める
- SaaSの話に入る直前で“誰の何が楽になったか”を一言で言う
- セキュリティは「怖い話」より「設計の型」として話す

## 全体構成（40–60分）
- 0–5分: 自己紹介と原体験
- 5–12分: 課題の解像度を上げる
- 12–22分: 設計の最初の意思決定
- 22–35分: セキュリティ設計の要点（非エンジニア視点）
- 35–45分: 失敗・遠回りと学び
- 45–55分: まとめ（非エンジニア向けの再現可能な型）
- 55–60分: Q&A

## スライド構成（20–24枚想定）
1. タイトル
2. 今日話すこと（アジェンダ）
3. 自己紹介（短く）
4. 原体験（作り始めた理由）
5. 誰の何を早くするのか
6. 46店舗運用の複雑さ
7. SaaSの価値を一言で
8. 5軸で全体像を固定する
9. 店舗=境界を最初に決める
10. 人（スタッフ/顧客）を分ける
11. 行動データは先に守る
12. お金・時間の軸を揃える
13. セキュリティは“型”で考える
14. DBで境界を守る（RLS）
15. JWTでO(1)判定にする
16. admin最強をやめた理由
17. 非認証はサーバゲートウェイ固定
18. PII最小化
19. 運用まで含めたセキュリティ
20. 失敗・遠回りの学び
21. まとめ（再現可能な型）
22. チェックリスト
23. 一行まとめ
24. Q&A

## 12–22分: 設計の最初の意思決定（詳細）
### Slide 8: 5軸で全体像を固定する
- 5軸: 店舗・人・行動・お金・時間
- データ設計が機能優先度を決める
- トーク要点: 「データが決まると優先度が勝手に決まる」
- 参照: `supabase/migrations/20250817000100_schema.sql`

### Slide 9: 店舗=境界を最初に決める
- テナント境界を clinic_id で固定
- 境界が曖昧だと全設計が揺れる
- トーク要点: 「どこまで見えていいかを最初に決める」
- 参照: `docs/stabilization/spec-rls-tenant-boundary-v0.1.md`

### Slide 10: 人（スタッフ/顧客）の扱いを分ける
- staffは認証あり、顧客は非認証前提
- 顧客フローはサーバAPI経由に限定
- トーク要点: 「同じ人に見えても流れは分けた方が安全」
- 参照: `docs/stabilization/spec-rls-tenant-boundary-v0.1.md`

### Slide 11: 行動=予約/来院/チャットを先に守る
- 行動データは本人性が前提
- RLSで保護対象に入れる
- トーク要点: 「行動データが一番漏れやすい」
- 参照: `supabase/migrations/20260111000100_rls_tenant_boundary_fix.sql`

### Slide 12: お金・時間の軸を揃える
- revenue/visits/daily_reports は clinic 境界と強く結びつく
- 時間軸を揃えると運用も可視化も揃う
- トーク要点: 「時間軸が揃うと運用が回る」
- 参照: `supabase/migrations/20250817000100_schema.sql`

## 22–35分: セキュリティ設計の要点（非エンジニア視点・詳細）
### Slide 13: セキュリティは“型”で考える
- デフォルト拒否 / 例外は明示
- 先にルールを決めることが最大の対策
- トーク要点: 「怖い話より“型”を決める」
- 参照: `docs/security-authz-rls-alignment-requirements.md`

### Slide 14: DBが境界を守る（RLS）
- App層 + DB層の二重チェック
- Appが壊れても越境しない
- トーク要点: 「DBは最後の砦」
- 参照: `docs/security-authz-rls-alignment-requirements.md`

### Slide 15: JWTでO(1)判定にした理由
- `jwt_clinic_id()` / `jwt_is_admin()` / `can_access_clinic()`
- サブクエリなしのO(1)
- トーク要点: 「RLSは遅いと言われるから最初に速度設計した」
- 参照: `supabase/migrations/20260111000100_rls_tenant_boundary_fix.sql`

### Slide 16: admin最強をやめた
- adminでも親スコープ制限
- 誤操作が最大の事故要因
- トーク要点: 「権限が強い人ほど事故の影響が大きい」
- 参照: `docs/stabilization/spec-rls-tenant-boundary-v0.1.md`

### Slide 17: 非認証はサーバゲートウェイ固定
- 顧客はRLSに任せずサーバAPIで制御
- clinic_id を必須で検証
- トーク要点: 「顧客はログインしない前提で設計した」
- 参照: `docs/stabilization/spec-rls-tenant-boundary-v0.1.md`

### Slide 18: PII最小化
- ヘッダー/レスポンスで余計な情報を返さない
- トーク要点: 「情報を出さないのが一番の防御」
- 参照: `docs/security-authz-rls-alignment-requirements.md`

### Slide 19: 運用まで含めたセキュリティ
- RLS適用前のバックアップ/検証
- index/監査ログまで設計に含める
- トーク要点: 「安全は“作った後”が本番」
- 参照: `RLS_DEPLOYMENT_MANUAL.md`

## 35–55分: 学びとまとめ（要点）
### 失敗・遠回りの学び（35–45分）
- 権限の一次ソースを早めに統一すべきだった
- admin最強を疑う視点が遅かった
- RLSの運用手順まで含めて設計すべきだった

### 再現可能な型（45–55分）
- 課題 → データ → 権限 → 運用 の順で決める
- 例外を最小化する設計が安全性を上げる
- “DBが守る”前提でアプリを作る

## 補助メモ（1行価値）
- 「現場の判断を1分でできるようにするために作った」
