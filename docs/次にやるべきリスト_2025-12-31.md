# æ¬¡ã«ã‚„ã‚‹ã¹ããƒªã‚¹ãƒˆï¼ˆ2025-12-31 æ›´æ–°ï¼‰

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¾åœ¨ã®çŠ¶æ…‹ã¨æ¬¡ã«å–ã‚Šçµ„ã‚€ã¹ãã‚¿ã‚¹ã‚¯ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

---

## ç›´è¿‘ã®ã‚¿ã‚¹ã‚¯ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰

### 1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ï¼ˆç®¡ç†è¨­å®šæ°¸ç¶šåŒ–ï¼‰

**çŠ¶æ…‹**: æœªå®Œäº†ï¼ˆDockerãŒå¿…è¦ï¼‰

```bash
# 1. Dockerèµ·å‹•
docker start supabase_db_seikotsuin

# 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
npx supabase db push
```

**å¯¾è±¡ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**:
- `20251231000100_clinic_settings_table.sql` - `clinic_settings` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ

**ç¢ºèªäº‹é …**:
- [ ] ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [ ] RLSãƒãƒªã‚·ãƒ¼ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [ ] RPCé–¢æ•°ãŒåˆ©ç”¨å¯èƒ½ãªã“ã¨

---

### 2. E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆç®¡ç†è¨­å®šï¼‰

**çŠ¶æ…‹**: æœªå®Ÿè¡Œ

```bash
# Playwright E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npx playwright test admin-settings

# UIãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
npx playwright test admin-settings --ui
```

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
- ç®¡ç†è€…ã§è¨­å®šã‚’ä¿å­˜ã—ã€å†èª­ã¿è¾¼ã¿å¾Œã«å¾©å…ƒã•ã‚Œã‚‹ã“ã¨
- æ¨©é™ã®ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šã‚’å¤‰æ›´ã§ããªã„ã“ã¨
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼æ™‚ã«é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨

---

### 3. TypeScriptã‚¨ãƒ©ãƒ¼ä¿®æ­£

**çŠ¶æ…‹**: æ—¢å­˜ã®å‹ã‚¨ãƒ©ãƒ¼ã‚ã‚Šï¼ˆ30ä»¶ç¨‹åº¦ï¼‰

ä¸»ãªã‚¨ãƒ©ãƒ¼ç®‡æ‰€:
- `src/api/gemini/ai-analysis-service.ts` - AIåˆ†æã‚µãƒ¼ãƒ“ã‚¹ã®å‹ä¸æ•´åˆ
- `src/app/admin/actions.ts` - Headerså‹ã®ä¸æ•´åˆ
- `src/app/reservations/` - äºˆç´„é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®Propsä¸è¶³
- `src/hooks/useSystemSettings.ts` - æ¼”ç®—å­ã®å„ªå…ˆé †ä½
- `src/lib/session-manager.ts` - Jsonå‹ã®ä¸æ•´åˆ
- `src/types/supabase.ts` - é‡è¤‡ã™ã‚‹å‹å®šç¾©

**å¯¾å¿œæ–¹é‡**:
```bash
# å‹ã‚¨ãƒ©ãƒ¼ç¢ºèª
npm run type-check

# ã‚¨ãƒ©ãƒ¼ç®‡æ‰€ã‚’ç‰¹å®šã—ã¦ä¿®æ­£
```

---

## ä¸­æœŸã‚¿ã‚¹ã‚¯ï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰

### 4. å‹•ä½œç¢ºèªãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ

- [ ] ç®¡ç†ç”»é¢ã§å…¨è¨­å®šã‚«ãƒ†ã‚´ãƒªã®ä¿å­˜ãƒ»å¾©å…ƒãŒæ©Ÿèƒ½ã™ã‚‹ã“ã¨
- [ ] ç•°ãªã‚‹ãƒ–ãƒ©ã‚¦ã‚¶/ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã‚‚è¨­å®šãŒå…±æœ‰ã•ã‚Œã‚‹ã“ã¨
- [ ] ç›£æŸ»ãƒ­ã‚°ã«è¨­å®šå¤‰æ›´ãŒè¨˜éŒ²ã•ã‚Œã‚‹ã“ã¨

### 5. æ—¢å­˜ãƒ†ã‚¹ãƒˆã®ä¿®æ­£

ä¸€éƒ¨ã®æ—¢å­˜ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ç¢ºèªã¨ä¿®æ­£ãŒå¿…è¦:

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè¡Œ
npm test -- --testPathPattern="admin-settings"
```

### 6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

```bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ãƒ†ã‚¹ãƒˆ
npm test -- --testPathPattern="security"
```

---

## é•·æœŸã‚¿ã‚¹ã‚¯ï¼ˆå„ªå…ˆåº¦: ä½ï¼‰

### 7. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

- [ ] APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
- [ ] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®Storybookè¿½åŠ 
- [ ] é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®ä½œæˆ

### 8. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

- [ ] è¨­å®šèª­ã¿è¾¼ã¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
- [ ] å¤§é‡ãƒ‡ãƒ¼ã‚¿æ™‚ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³

### 9. æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™

- [ ] ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
- [ ] æœ¬ç•ªDBã¸ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»
- [ ] ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã®ä½œæˆ

---

## å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯

### ç®¡ç†è¨­å®šæ°¸ç¶šåŒ– MVP

| Phase | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|-------|------|----------|
| Phase 1 | DB/API/ãƒ•ãƒƒã‚¯åŸºç›¤å®Ÿè£… | âœ… å®Œäº† |
| Phase 2 | å…¨è¨­å®šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¯¾å¿œ | âœ… å®Œäº† |
| Phase 3 | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ãƒ»E2Eãƒ†ã‚¹ãƒˆ | ğŸ”„ é€²è¡Œä¸­ |

**å®Œäº†ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
- `clinic-basic-settings.tsx` (Phase 1)
- `clinic-hours-settings.tsx`
- `booking-calendar-settings.tsx`
- `communication-settings.tsx`
- `system-settings.tsx`
- `services-pricing-settings.tsx`
- `insurance-billing-settings.tsx`
- `data-management-settings.tsx`

---

## æŠ€è¡“çš„ãªæ³¨æ„äº‹é …

### useAdminSettings ãƒ•ãƒƒã‚¯ã®ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

```tsx
import { useAdminSettings } from '@/hooks/useAdminSettings';
import { useUserProfile } from '@/hooks/useUserProfile';
import { AdminMessage } from '@/components/admin/AdminMessage';
import { Loader2 } from 'lucide-react';

// çµ±ä¸€ãƒ‡ãƒ¼ã‚¿å‹
interface SettingsData {
  // ã‚«ãƒ†ã‚´ãƒªå›ºæœ‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
}

const initialData: SettingsData = {
  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
};

export function SettingsComponent() {
  const { profile, loading: profileLoading } = useUserProfile();
  const clinicId = profile?.clinicId;

  const {
    data: formData,
    updateData,
    loadingState,
    handleSave,
    isInitialized,
  } = useAdminSettings(initialData, clinicId ? {
    clinicId,
    category: 'category_name',
    autoLoad: true,
  } : undefined);

  if (profileLoading || !isInitialized) {
    return (
      <div className="flex items-center justify-center py-12">
        <Loader2 className="w-8 h-8 animate-spin text-blue-500" />
        <span className="ml-2 text-gray-600">è¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
      </div>
    );
  }

  // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
  const updateField = (updates: Partial<SettingsData>) => {
    updateData(updates);
  };

  return (
    <div>
      {loadingState.error && (
        <AdminMessage message={loadingState.error} type="error" />
      )}
      {loadingState.savedMessage && !loadingState.error && (
        <AdminMessage message={loadingState.savedMessage} type="success" />
      )}
      {/* ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
    </div>
  );
}
```

---

## å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/ç®¡ç†è¨­å®šæ°¸ç¶šåŒ–_MVPä»•æ§˜æ›¸.md` - è©³ç´°ä»•æ§˜
- `docs/E2Eå…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ä»•æ§˜æ›¸.md` - E2Eãƒ†ã‚¹ãƒˆè¨­è¨ˆ
- `CLAUDE.md` - é–‹ç™ºã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
